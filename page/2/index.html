<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">






  <link rel="canonical" href="http://yoursite.com/page/2/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hexo</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/01/java-web-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/01/java-web-7/" itemprop="url">
                  数据库链接池原生java-api实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-01 16:26:03" itemprop="dateCreated datePublished" datetime="2018-04-01T16:26:03+08:00">2018-04-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-05-06 10:46:32" itemprop="dateModified" datetime="2018-05-06T10:46:32+08:00">2018-05-06</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java-web/" itemprop="url" rel="index"><span itemprop="name">java-web</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>通常在做java-web开发时，最需要做的就是配置数据库连接；从简单的jdbc直接使用到使用第三方分装的orm。在使用传统的jdbc进行数据库操作时，经常是当要进行一个数据库操作时，就开启一个数据库连接，操作完成后就关闭数据库连接。频繁的数据库连接对象的申请与释放，导致大量的资源耗费在了数据库连接创建与释放上面，而第三方的orm框架则采用了数据库连接池的办法，极大的优化了数据库连接的频繁申请与释放操作：需要进行数据库操作时，从数据库连接池中获取一个可用连接；不用时将连接返还给连接池；而连接池维护着每一个数据库连接的连接生命周期，只要还在数据库连接还在生命周期内，那么这个数据库连接就不会断开。</p>
<blockquote>
<p>java数据库连接池的图示展示</p>
</blockquote>
<p><img src="http://120.24.90.180:8080/blog/image/java_web/java-web-7.2.png" alt="java-web-7.2"></p>
<blockquote>
<p>java数据库连接池的实现思路</p>
</blockquote>
<p>java数据库连接池在jdk中已经有相关的接口了——java.sql.DataSource；但是如果我们要手动实现一个数据库连接池的时候，应该怎么去做？数据库连接池最重要的是实现池的作用——成为数据库连接对象的容器以及管理容器内的所有数据库连接对象；实现当数据库连接断开时，连接对象不是被直接回收，而是重新回到容器中（这是最难的点）；容器的话，可以采用线程安全的java.util.Vector来充当。而对象的重新回收到容器当中，可以利用java的代理机制来实现——实现数据库连接对象的代理。</p>
<blockquote>
<p>java数据库连接池代码实现</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://127.0.0.0:3306/jdbcpool</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=xxxx</span><br><span class="line">jdbc.poolsize=10</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLFeatureNotSupportedException;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataSource</span> <span class="keyword">implements</span> <span class="title">DataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Vector&lt;Connection&gt; connections = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态代码区，通过properties文件获取相关数据库配置信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        InputStream in = MyDataSource.class.getClassLoader().getResourceAsStream(<span class="string">"myDB.properties"</span>);</span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(in);</span><br><span class="line">            String driver = properties.getProperty(<span class="string">"jdbc.driver"</span>);</span><br><span class="line">            String url = properties.getProperty(<span class="string">"jdbc.url"</span>);</span><br><span class="line">            String username = properties.getProperty(<span class="string">"jdbc.username"</span>);</span><br><span class="line">            String password = properties.getProperty(<span class="string">"jdbc.password"</span>);</span><br><span class="line">            <span class="keyword">int</span> poolsize = Integer.valueOf(properties.getProperty(<span class="string">"jdbc.poolsize"</span>));</span><br><span class="line">            Class.forName(driver);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; poolsize; i ++) &#123;</span><br><span class="line">                Connection connection = DriverManager.getConnection(url, username, password);</span><br><span class="line">                System.out.println(<span class="string">"success get connection"</span>);</span><br><span class="line">                connections.addElement(connection);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (connections.size()&gt;<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//从Connections集合中获取一个数据库连接</span></span><br><span class="line">            <span class="keyword">final</span> Connection conn = connections.remove(<span class="number">0</span>);</span><br><span class="line">            System.out.println(<span class="string">"jdbc pool size is :"</span> + connections.size());</span><br><span class="line">            <span class="comment">//返回Connection对象的代理对象</span></span><br><span class="line">            <span class="keyword">return</span> (Connection) Proxy.newProxyInstance(MyDataSource.class.getClassLoader(), conn.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler()&#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></span><br><span class="line"><span class="function">                        <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(!method.getName().equals(<span class="string">"close"</span>))&#123;</span><br><span class="line">                        <span class="keyword">return</span> method.invoke(conn, args);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="comment">//如果调用的是Connection对象的close方法，就把conn还给数据库连接池</span></span><br><span class="line">                        connections.addElement(conn);</span><br><span class="line">                        System.out.println(conn + <span class="string">"return to jdbc pool"</span>);</span><br><span class="line">                        System.out.println(<span class="string">"jdbc pool size is"</span> + connections.size());</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"busy"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">unwrap</span><span class="params">(Class&lt;T&gt; iface)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isWrapperFor</span><span class="params">(Class&lt;?&gt; iface)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PrintWriter <span class="title">getLogWriter</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLogWriter</span><span class="params">(PrintWriter out)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLoginTimeout</span><span class="params">(<span class="keyword">int</span> seconds)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getLoginTimeout</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Logger <span class="title">getParentLogger</span><span class="params">()</span> <span class="keyword">throws</span> SQLFeatureNotSupportedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>数据库连接池测试(picture)</p>
</blockquote>
<p><img src="http://120.24.90.180:8080/blog/image/java_web/java-web-7.1.png" alt="数据库连接池测试-运行结果展示"></p>
<blockquote>
<p>数据库连接池测试(Video)</p>
</blockquote>
<p><a href="https://www.bilibili.com/video/av21775157/" target="_blank" rel="noopener">bilibili video by Mynameis蠢逼</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/31/linux-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/31/linux-4/" itemprop="url">
                  Storm分布式计算框架的搭建过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-03-31 15:57:00 / Modified: 16:55:37" itemprop="dateCreated datePublished" datetime="2018-03-31T15:57:00+08:00">2018-03-31</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>什么是storm</p>
</blockquote>
<p>storm是一个分布式的计算框架，并且，storm是基于内存式的计算服务，在storm计算期间，所有的数据都在内存中进行计算，没有进行耗时的io操作，也正是因为storm的这种特性，使得storm与hadoop的批处理形式不同，storm是流处理的形式，只要数据一进来就开始进行计算服务。</p>
<blockquote>
<p>依赖一：zookeeper</p>
</blockquote>
<p>zookeeper是一个分布式应用协调工具。其实可以这样说，zookeeper就是一个管家，它管理着一个分布式集群，所有的机器调度都通过zookeeper进行协调。</p>
<p>进入Apache官网下载zookeeper后进行解压缩，然后进入conf目录，创建一个新的文件<code>conf.cfg</code>，文件内容如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tickTime=2000  </span><br><span class="line">dataDir= /usr/myenv/zookeeper-3.4.8/data  (填写自己的data目录)  </span><br><span class="line">dataLogDir=/usr/myenv/zookeeper-3.4.8/logs  </span><br><span class="line">clientPort=2181</span><br></pre></td></tr></table></figure></p>
<p>每个参数的含义：<br>。tickTime: zookeeper中使用的基本时间单位, 毫秒值<br>。dataDir: 数据目录. 可以是任意目录<br>。dataLogDir: log目录, 同样可以是任意目录. 如果没有设置该参数, 将使用和#dataDir相同的设置.<br>。clientPort: 监听client连接的端口号.</p>
<p>然后保存该文件，回到conf的上一层目录，进入bin目录，然后执行如下指令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./zkServer.sh start   (开启指令)</span><br><span class="line">./zkServer.sh stop    (关闭指令)</span><br></pre></td></tr></table></figure>
<p><img src="http://120.24.90.180:8080/blog/image/linux/linux-4.1.png" alt="zookeeper start"></p>
<blockquote>
<p>依赖二：zeromq</p>
</blockquote>
<p>如果是mac os的话，直接使用brew的包管理器进行安装：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install zeromq</span><br></pre></td></tr></table></figure></p>
<p>如果是linux的话，这里有一个脚本，直接使用就可以<br><a href="https://gist.github.com/katopz/8b766a5cb0ca96c816658e9407e83d00" target="_blank" rel="noopener">githu地址</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/usr/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Download zeromq</span><br><span class="line"><span class="meta">#</span> Ref http://zeromq.org/intro:get-the-software</span><br><span class="line">wget https://github.com/zeromq/libzmq/releases/download/v4.2.2/zeromq-4.2.2.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Unpack tarball package</span><br><span class="line">tar xvzf zeromq-4.2.2.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Install dependency</span><br><span class="line">sudo apt-get update &amp;&amp; \</span><br><span class="line">sudo apt-get install -y libtool pkg-config build-essential autoconf automake uuid-dev</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Create make file</span><br><span class="line">cd zeromq-4.2.2</span><br><span class="line">./configure</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Build and install(root permission only)</span><br><span class="line">sudo make install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Install zeromq driver on linux</span><br><span class="line">sudo ldconfig</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Check installed</span><br><span class="line">ldconfig -p | grep zmq</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Expected</span><br><span class="line"><span class="meta">#</span>###########################################################</span><br><span class="line"><span class="meta">#</span> libzmq.so.5 (libc6,x86-64) =&gt; /usr/local/lib/libzmq.so.5</span><br><span class="line"><span class="meta">#</span> libzmq.so (libc6,x86-64) =&gt; /usr/local/lib/libzmq.so</span><br><span class="line"><span class="meta">#</span>###########################################################</span><br></pre></td></tr></table></figure>
<blockquote>
<p>搭建storm分布式计算框架</p>
</blockquote>
<p>在Apache官网下载storm之后，解压缩，进入conf目录下，找到<code>stoem.ymal</code>文件；打开文件进行编辑：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#配置Zookeeper</span><br><span class="line">storm.zookeeper.servers:</span><br><span class="line">    - &quot;127.0.0.1&quot;</span><br><span class="line">storm.zookeeper.port: 2181</span><br><span class="line">storm.zookeeper.root: &quot;/storm&quot;</span><br><span class="line"></span><br><span class="line">#配置数据存储路径(这里的路径是我自己的，按自己需求来更改)</span><br><span class="line">storm.local.dir: &quot;/Volumes/Extended/Data/apache-storm/data&quot;</span><br><span class="line"></span><br><span class="line">#配置节点健康检测</span><br><span class="line">storm.health.check.dir: &quot;healthchecks&quot;</span><br><span class="line">storm.health.check.timeout.ms: 5000</span><br><span class="line"></span><br><span class="line">#配置Nimbus节点，如果有多个，可以填写，用逗号隔开</span><br><span class="line">nimbus.seeds: [&quot;127.0.0.1&quot;]</span><br><span class="line"></span><br><span class="line">#配置Storm UI</span><br><span class="line">ui.port: 8088</span><br><span class="line"></span><br><span class="line">## 配置DRPC服务</span><br><span class="line">drpc.servers:</span><br><span class="line">    - &quot;127.0.0.1&quot;</span><br></pre></td></tr></table></figure>
<p>修改文件后保存，回退到conf的上层目录，进入bin目录，然后执行以下三条命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ ./storm nimbus &amp;</span><br><span class="line">➜  ~ ./storm ui &amp;</span><br><span class="line">➜  ~ ./storm drpc &amp;</span><br></pre></td></tr></table></figure>
<p>然后在浏览器地址栏输入<code>http://127.0.0.1:8088</code>(端口号就是你设置的ui.port，我这里设置的是8088)，然后如果看到这个界面，就表示配置成功了！！！</p>
<p><img src="http://120.24.90.180:8080/blog/image/linux/linux-4.2.png" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/29/leetcode-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/29/leetcode-4/" itemprop="url">
                  深度优先搜索之Flood Fill
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-03-29 21:07:52" itemprop="dateCreated datePublished" datetime="2018-03-29T21:07:52+08:00">2018-03-29</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>题目</p>
</blockquote>
<p>“””<br>An image is represented by a 2-D array of integers, each integer representing the pixel value of the image (from 0 to 65535).</p>
<p>Given a coordinate (sr, sc) representing the starting pixel (row and column) of the flood fill, and a pixel value newColor,<br>“flood fill” the image.</p>
<p>To perform a “flood fill”, consider the starting pixel, plus any pixels connected 4-directionally to the starting pixel<br>of the same color as the starting pixel, plus any pixels connected 4-directionally to those pixels (also with the same<br>color as the starting pixel), and so on. Replace the color of all of the aforementioned pixels with the newColor.</p>
<p>At the end, return the modified image.</p>
<p>Example 1:<br>Input:<br>image = [[1,1,1],[1,1,0],[1,0,1]]<br>sr = 1, sc = 1, newColor = 2<br>Output: [[2,2,2],[2,2,0],[2,0,1]]<br>Explanation:<br>From the center of the image (with position (sr, sc) = (1, 1)), all pixels connected<br>by a path of the same color as the starting pixel are colored with the new color.<br>Note the bottom corner is not colored 2, because it is not 4-directionally connected<br>to the starting pixel.<br>“””</p>
<p>用过ps的人应该都熟悉一个功能，就是颜色填充；而这道题目的意思，其实就像颜色填充一样，把一个区域的oldColor用newColor代替，因此，这里就涉及到了如何识别一个区域？</p>
<blockquote>
<p>洪水填充算法</p>
</blockquote>
<p>洪水会向四周能够流动的地方流动，因此我们就可以模范洪水的流动方式：在某个点，对这个点的四个方向进行可流动性判断，如果是可流动的，那么就流过去，否则不流，其实就是判断这个点的四个方向上的点与当前的点是不是属于同一块区域，然后进行替换操作；当四个方向都执行完之后，就采用深度优先搜索向下一个点出发，继续之前的操作，直到所有需要被替换的区域都已经被替换成新的信息位置</p>
<blockquote>
<p>注意点</p>
</blockquote>
<p>由于DFS是递归运行的，所以可能会出现由于递归的深度过深导致栈爆炸，因此需要利用python中的<code>sys</code>模块，进行如下设置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sys.setrecursionlimit(<span class="number">100000</span>)</span><br><span class="line">(设置递归的深度)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>代码</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">sys.setrecursionlimit(<span class="number">1000000</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">floodFill</span><span class="params">(self, image, sr, sc, newColor)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type image: List[List[int]]</span></span><br><span class="line"><span class="string">        :type sr: int</span></span><br><span class="line"><span class="string">        :type sc: int</span></span><br><span class="line"><span class="string">        :type newColor: int</span></span><br><span class="line"><span class="string">        :rtype: List[List[int]]</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        wight, length = len(image), len(image[<span class="number">0</span>])</span><br><span class="line">        oldColor = image[sr][sc]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(wight):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(length):</span><br><span class="line">                <span class="keyword">if</span> image[i][j] == oldColor <span class="keyword">and</span> image[i][j] != newColor:</span><br><span class="line">                    self.DFS(image, newColor, sr, sc, oldColor)</span><br><span class="line">        <span class="keyword">return</span> image</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">DFS</span><span class="params">(self, image, newColor, i, j, oldColor)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="number">0</span> <span class="keyword">or</span> i &gt;= len(image):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> j &lt; <span class="number">0</span> <span class="keyword">or</span> j &gt;= len(image[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> image[i][j] != oldColor:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        image[i][j] = newColor</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">fill_color</span><span class="params">(_image, _i, _j)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> _i &lt; <span class="number">0</span> <span class="keyword">or</span> _i &gt;= len(image):</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">if</span> _j &lt; <span class="number">0</span> <span class="keyword">or</span> _j &gt;= len(image[<span class="number">0</span>]):</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">if</span> _image[i][j] != oldColor:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            _image[i][j] = newColor</span><br><span class="line"></span><br><span class="line">        fill_color(image, i, j + <span class="number">1</span>)</span><br><span class="line">        fill_color(image, i, j - <span class="number">1</span>)</span><br><span class="line">        fill_color(image, i + <span class="number">1</span>, j)</span><br><span class="line">        fill_color(image, i - <span class="number">1</span>, j)</span><br><span class="line">        self.DFS(image, newColor, i, j + <span class="number">1</span>, oldColor)</span><br><span class="line">        self.DFS(image, newColor, i, j - <span class="number">1</span>, oldColor)</span><br><span class="line">        self.DFS(image, newColor, i + <span class="number">1</span>, j, oldColor)</span><br><span class="line">        self.DFS(image, newColor, i - <span class="number">1</span>, j, oldColor)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    s = Solution()</span><br><span class="line">    image = [[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]]</span><br><span class="line">    sr = <span class="number">1</span></span><br><span class="line">    sc = <span class="number">1</span></span><br><span class="line">    newColor = <span class="number">2</span></span><br><span class="line">    <span class="keyword">print</span> s.floodFill(image, sr, sc, newColor)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/15/linux-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/15/linux-3/" itemprop="url">
                  linux——操作系统之实现银行家算法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-03-15 11:03:23" itemprop="dateCreated datePublished" datetime="2018-03-15T11:03:23+08:00">2018-03-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-04-26 11:58:14" itemprop="dateModified" datetime="2018-04-26T11:58:14+08:00">2018-04-26</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>死锁问题</p>
</blockquote>
<p>现如今的操作系统基本上都实现了多任务以及并发机制，由此，带来了一个明显的问题——进程资源分配的问题。假设有两个进程a、b，a完成任务需要资源R1、R2，b完成任务也需要资源R1、R2，系统的R1、R2资源数目都是1；这个时候，由于分配的原因，a进程只拿到了R1资源，b只拿到了R2资源；为了完成各自的任务，a进程在不放弃原有的R1资源下向系统申请R2资源，b进程在不放弃原有的R2资源下向系统申请R1资源，整个资源申请的图如下所示</p>
<p><img src="http://120.24.90.180:8080/blog/image/linux/linux-3.1.png" alt="资源申请图"></p>
<p>由于a进程占有着R1资源去向系统申请R2资源，但是R2资源被需要R1资源的b进程所占有，两个进程占有着对方完成任务所需的剩余资源，同时又不放弃自身已有的资源，因此就出现了死锁问题。</p>
<blockquote>
<p>银行家算法</p>
</blockquote>
<p>银行家算法是提前判断当前资源分配是否会出现死锁情况。整个算法大致思路如下：</p>
<ol>
<li>建立各个进程完成任务需要的资源情况表：Max[进程数目][资源种类数目]</li>
<li>建立各个进程已经获得的资源情况表：Allocation[进程数目][资源种类数目]</li>
<li>建立各个进程还需要的资源情况表：Need[进程数目][资源种类数目]</li>
<li>建立各个资源剩余情况表：Avliable[资源种类数目]</li>
<li>判断Avliable表满足Need表中的那一个进程(重要)</li>
<li>为满足的进程分配需要的资源，进程完成任务(重要)</li>
<li>回收进程完成任务的占有资源(重要)</li>
<li>判断是否所有进程都已完成各自的任务，若存在未完成任务的进程，则当前的进程资源分配一定存在死锁现象(重要)</li>
</ol>
<p>银行家算法最主要的就是第5步骤到第8步骤，对剩余资源和各个进程还需资源进行比较、分配；分配的先后顺序可能会导致死锁，也可能使各个进程能够完成各自任务；能够使各个进程完成各自任务的资源分配顺序成为安全序列，因此也可以说银行家算法是判断是否存在一个安全序列使得进程完成各自任务。</p>
<p>为了判断能否得到安全序列，就要不断尝试各种资源分配顺序，在尝试的过程中，需要对Avliable表进行副本保存，用来恢复原始的Avliable表；同时设置worker数组，用于记录进程完成任务情况。</p>
<blockquote>
<p>银行家算法实现</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isEnough</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> a[], <span class="keyword">int</span> b[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">" : "</span> &lt;&lt; a[<span class="number">0</span>] &lt;&lt; a[<span class="number">1</span>] &lt;&lt; a[<span class="number">2</span>] &lt;&lt; a[<span class="number">3</span>] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">bool</span> b1 = (a[<span class="number">0</span>] &lt;= b[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">bool</span> b2 = (a[<span class="number">1</span>] &lt;= b[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">bool</span> b3 = (a[<span class="number">2</span>] &lt;= b[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">bool</span> b4 = (a[<span class="number">3</span>] &lt;= b[<span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">if</span> (b1 &amp;&amp; b2 &amp;&amp; b3 &amp;&amp; b4)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isFinish</span><span class="params">(<span class="keyword">bool</span> worker[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (worker[<span class="number">0</span>] &amp;&amp; worker[<span class="number">1</span>] &amp;&amp; worker[<span class="number">2</span>] &amp;&amp; worker[<span class="number">3</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getUnFinish</span><span class="params">(<span class="keyword">bool</span> worker[], <span class="keyword">int</span> loc)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!isFinish(worker)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((!worker[i]) &amp;&amp; (i != loc)) &#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">        i ++;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">4</span>) &#123;</span><br><span class="line">            i = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>* <span class="title">addResource</span><span class="params">(<span class="keyword">int</span> *Avliable, <span class="keyword">int</span> Allocation[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *ans = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i ++) &#123;</span><br><span class="line">        ans[i] = Avliable[i] + Allocation[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">safe</span><span class="params">(<span class="keyword">int</span> Allocation[][<span class="number">4</span>], <span class="keyword">int</span> Need[][<span class="number">4</span>], <span class="keyword">int</span> Avliable[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp_avliable[<span class="number">4</span>];</span><br><span class="line">    copy(Avliable, Avliable + <span class="number">4</span>, tmp_avliable);</span><br><span class="line">    <span class="keyword">bool</span> worker[<span class="number">4</span>] = &#123;<span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>&#125;;</span><br><span class="line">    <span class="keyword">bool</span> judge = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEnough(i, Need[i], Avliable))</span><br><span class="line">        &#123;</span><br><span class="line">            Avliable = addResource(Avliable, Allocation[i]);</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">            worker[i] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">int</span> un_worker = getUnFinish(worker, <span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">while</span> (!isFinish(worker)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (count &gt; <span class="number">5</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (un_worker == <span class="number">-1</span>) &#123;</span><br><span class="line">                    judge = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (isEnough(un_worker, Need[un_worker], Avliable)) &#123;</span><br><span class="line">                    Avliable = addResource(Avliable, Allocation[un_worker]);</span><br><span class="line">                    worker[un_worker] = <span class="literal">true</span>;</span><br><span class="line">                    un_worker = getUnFinish(worker, <span class="number">-1</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    un_worker = getUnFinish(worker, un_worker);</span><br><span class="line">                &#125;</span><br><span class="line">                count += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isFinish(worker) || judge) &#123;</span><br><span class="line">            judge = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        copy(tmp_avliable, tmp_avliable + <span class="number">4</span>, Avliable);</span><br><span class="line">        <span class="built_in">memset</span>(worker, <span class="literal">false</span>, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (judge) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"存在安全序列"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"不存在安全序列，存在死锁情况"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 各个进程已经拿到的资源情况</span></span><br><span class="line">    <span class="keyword">int</span> Allocation[<span class="number">4</span>][<span class="number">4</span>] = &#123;&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;,</span><br><span class="line">                            &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">                            &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>&#125;,</span><br><span class="line">                            &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>&#125;&#125;;</span><br><span class="line">    <span class="comment">// 各个进程完成各自任务所需要的资源数</span></span><br><span class="line">    <span class="keyword">int</span> Max[<span class="number">4</span>][<span class="number">4</span>] = &#123;&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>&#125;,</span><br><span class="line">                     &#123;<span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">0</span>&#125;,</span><br><span class="line">                     &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>&#125;,</span><br><span class="line">                     &#123;<span class="number">0</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>&#125;&#125;;</span><br><span class="line">    <span class="comment">// 各个进程在已经得到资源的基础上，为了完成任务还需要的资源数量</span></span><br><span class="line">    <span class="keyword">int</span> Need[<span class="number">4</span>][<span class="number">4</span>] = &#123;&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">                      &#123;<span class="number">0</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">0</span>&#125;,</span><br><span class="line">                      &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>&#125;,</span><br><span class="line">                      &#123;<span class="number">0</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>&#125;&#125;;</span><br><span class="line">    <span class="comment">// 资源剩余量</span></span><br><span class="line">    <span class="keyword">int</span> Avliable[<span class="number">4</span>] = &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    safe(Allocation, Need, Avliable);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/26/machine-learning-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/26/machine-learning-6/" itemprop="url">
                  机器学习之AdaBoost
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-26 20:25:36" itemprop="dateCreated datePublished" datetime="2018-02-26T20:25:36+08:00">2018-02-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-05-06 10:47:02" itemprop="dateModified" datetime="2018-05-06T10:47:02+08:00">2018-05-06</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/机器学习/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前看的机器学习的分类算法所构建的分类器都是单分类器，就是一整个算法当中，只构建了一个分类器用于分类。单分类器算法构建简单，但是缺点也很大——就是<code>独裁</code>，这个分类器所分类的结果就是最终的结果，缺少多方的意见，因此，就希望分类算法能够实现多方意见机制，也就是多个分类器共同分类来决定其最终的分类结果。</p>
<p>这个多方意见机制其实就像专家咨询机制，每一个专家的权威不同，所给出的意见也就不同，其最中的结果，需要综合各方的意见以及可采信程度综合得出最终的意见结果；对于分类器而言，可信度就是该分类器的采信权重alpha，其计算公式为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">µ = 分错的样本个数 / 总样本个数</span><br><span class="line">alpha = 1 / 2 * ln((1 - µ) / µ)</span><br></pre></td></tr></table></figure>
<p>专家个数呢？其实就是同一种分类器，根据采信程度来区分成不同的<code>分类器</code>；但是，一个分类器用一个样本训练，无论训练多少次应该只能得到一个分类器模型才对，那是怎么得到这么多不同的采信程度不同的分类器？这个adaboost算法已经解决了。</p>
<blockquote>
<p>AdaBoost</p>
</blockquote>
<p>adaboost算法是解决上面问题的一种实现方案，adaboost算法就是一种生成多个置信程度不同的分类器，然后将这些分类起器分类结果进行加权求和得到最终的分类结果，而这个权重值，就是刚刚说的aplha值：1 / 2 * ln((1 - µ) / µ)，µ = 分错的样本个数 / 总样本个数；那么分类器可以选择什么呢？可以是前面的朴素贝叶斯分类器，可以是决策树，可以是Logistic回归分类器等等等；在这里，用了最容易实现的单层决策树来作为adaboost的基分类器。</p>
<blockquote>
<p>单层决策树</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stumpClassify</span><span class="params">(dataMatrix, dimen, threshVal, threshIneq)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :param dataMatrix:</span></span><br><span class="line"><span class="string">    :param dimen:</span></span><br><span class="line"><span class="string">    :param threshVal:</span></span><br><span class="line"><span class="string">    :param threshIneq:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    retArray = np.ones((np.shape(dataMatrix)[<span class="number">0</span>], <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> threshIneq == <span class="string">'lt'</span>:</span><br><span class="line">        retArray[dataMatrix[:, dimen] &lt;= threshVal] = <span class="number">-1.0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        retArray[dataMatrix[:, dimen] &gt;= threshVal] = <span class="number">-1.0</span></span><br><span class="line">    <span class="keyword">return</span> retArray</span><br></pre></td></tr></table></figure>
<p>利用上面的代码我们构建成了一个单层决策树，单层决策树的算法是在某个特征上取一个阈值并通过大小关系来实现二分类。</p>
<blockquote>
<p>得到当前最好的单决策树 </p>
</blockquote>
<p>分类器的好坏判别标准就是分类的准确率，遍历所有特征，同时，在某特征下，遍历所有该特征的可能取值；就这样通过双重循环，不断得到不同的单层决策树，通过计算准确率以及和最大正确率（最小错误率）比较，取得单层决策树的最优树；同时，在python的字典对象中保存最优单层决策树的特征信息：{第几个特征； 该特征的取值；正确率；错误率}</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buildStump</span><span class="params">(dataArr, classLabels, D)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :param dataArr:</span></span><br><span class="line"><span class="string">    :param classLabels:</span></span><br><span class="line"><span class="string">    :param D:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    dataMatrix = np.mat(dataArr);</span><br><span class="line">    labelMat = np.mat(classLabels).T</span><br><span class="line">    m, n = np.shape(dataMatrix)</span><br><span class="line">    numSteps = <span class="number">10.0</span>;</span><br><span class="line">    bestStump = &#123;&#125;;</span><br><span class="line">    bestClassEst = np.mat(np.zeros((m, <span class="number">1</span>)))</span><br><span class="line">    minError = np.inf</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        rangeMin = dataMatrix[:, i].min();</span><br><span class="line">        rangeMax = dataMatrix[:, i].max()</span><br><span class="line">        stepSize = (rangeMax - rangeMin) / numSteps</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">-1</span>, int(numSteps) + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> inequal <span class="keyword">in</span> [<span class="string">'lt'</span>, <span class="string">'gt'</span>]:</span><br><span class="line">                threshVal = (rangeMin + np.float(j) * stepSize)</span><br><span class="line">                predictedVals = stumpClassify(dataMatrix, i, threshVal, inequal)</span><br><span class="line">                errArr = np.mat(np.ones((m, <span class="number">1</span>)))</span><br><span class="line">                errArr[predictedVals == labelMat] = <span class="number">0</span></span><br><span class="line">                weightedError = D.T * errArr</span><br><span class="line">                <span class="keyword">print</span> <span class="string">"split: dim %d, thresh %.2f, thresh ineqal: %s, the weights error is %.3f"</span> % (i, threshVal, inequal, weightedError)</span><br><span class="line">                <span class="keyword">if</span> weightedError &lt; minError:</span><br><span class="line">                    minError = weightedError</span><br><span class="line">                    bestClassEst = predictedVals.copy()</span><br><span class="line">                    bestStump[<span class="string">'dim'</span>] = i</span><br><span class="line">                    bestStump[<span class="string">'thresh'</span>] = threshVal</span><br><span class="line">                    bestStump[<span class="string">'ineq'</span>] = inequal</span><br><span class="line">    <span class="keyword">return</span> bestStump, minError, bestClassEst</span><br></pre></td></tr></table></figure>
<blockquote>
<p>adaboost 模型训练</p>
</blockquote>
<p>从上面已知最优决策树的获得方式，因此就可以通过训练模型，获得一个由最优单层决策树组成的list对象，最优单层决策树数组长度取决于最终模型训练的情况以及预初始化的数组长度；如果说模型训练的错误率小于等于给定的目标值，那么就结束模型训练，此时循环训练的轮数就是最优单层决策树数组的长度；如果训练轮数达到预初始值，那么直接结束循环，返回最优单层决策树数组。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adaBoostTrainDS</span><span class="params">(dataArr, classLabels, numIt=<span class="number">40</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    模型训练，返回numIt个单决策树模型数组</span></span><br><span class="line"><span class="string">    :param dataArr:</span></span><br><span class="line"><span class="string">    :param classLabels:</span></span><br><span class="line"><span class="string">    :param numIt:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    weakClassArr = []</span><br><span class="line">    m = np.shape(dataArr)[<span class="number">0</span>]</span><br><span class="line">    D = np.mat(np.ones((m, <span class="number">1</span>)) / m)</span><br><span class="line">    aggClassEst = np.mat(np.zeros((m, <span class="number">1</span>)))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(numIt):</span><br><span class="line">        bestStump, error, classEst = buildStump(dataArr, classLabels, D)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"D:"</span>, D.T</span><br><span class="line">        alpha = np.float(<span class="number">0.5</span> * np.log((<span class="number">1.0</span> - error) / max(error, <span class="number">1e-16</span>)))</span><br><span class="line">        bestStump[<span class="string">'alpha'</span>] = alpha</span><br><span class="line">        weakClassArr.append(bestStump)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"classEst:"</span>, classEst.T</span><br><span class="line">        expon = np.multiply(<span class="number">-1</span> * alpha * np.mat(classLabels).T, classEst)</span><br><span class="line">        D = np.multiply(D, np.exp(expon))</span><br><span class="line">        D = D / D.sum()</span><br><span class="line">        aggClassEst += alpha * classEst</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"aggClassEst:"</span>, aggClassEst.T</span><br><span class="line">        aggErrors = np.multiply(np.sign(aggClassEst) != np.mat(classLabels).T, np.ones((m, <span class="number">1</span>)))</span><br><span class="line">        errorRate = aggErrors.sum() / m</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"total error:"</span>, errorRate, <span class="string">'\n'</span></span><br><span class="line">        <span class="keyword">if</span> errorRate == <span class="number">0.0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> weakClassArr</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分类函数</p>
</blockquote>
<p>根据上一步获得最优单层决策树数组，计算每个最优单层决策树的分类情况，乘上对应的权重值，累加之后得到aggClassEst，之后利用np.sign函数进行计算，将向量映射到[0, 1]空间，实现最后的二分类效果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adaClassify</span><span class="params">(datToClass, classifierArr)</span>:</span></span><br><span class="line">    <span class="string">"""[summary]</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Arguments:</span></span><br><span class="line"><span class="string">        datToClass &#123;[type]&#125; -- [description]</span></span><br><span class="line"><span class="string">        classifierArr &#123;[type]&#125; -- [description]</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        [type] -- [description]</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    dataMatrix = np.mat(datToClass)</span><br><span class="line">    m = np.shape(dataMatrix)[<span class="number">0</span>]</span><br><span class="line">    aggClassEst = np.mat(np.zeros((m, <span class="number">1</span>)))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(classifierArr)):</span><br><span class="line">        classEst = stumpClassify(dataMatrix, classifierArr[i][<span class="string">'dim'</span>], classifierArr[i][<span class="string">'thresh'</span>], classifierArr[i][<span class="string">'ineq'</span>])</span><br><span class="line">        aggClassEst += classifierArr[i][<span class="string">'alpha'</span>] * classEst</span><br><span class="line">        <span class="keyword">print</span> aggClassEst</span><br><span class="line">    <span class="keyword">return</span> np.sign(aggClassEst)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/16/machine-learning-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/16/machine-learning-5/" itemprop="url">
                  机器学习之线性回归
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-16 11:46:19" itemprop="dateCreated datePublished" datetime="2018-02-16T11:46:19+08:00">2018-02-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-05-06 10:47:33" itemprop="dateModified" datetime="2018-05-06T10:47:33+08:00">2018-05-06</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/机器学习/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>回归问题，可以说是一个很有趣的问题——用已有的数据去预测未来的数据。</p>
<p>回归问题其实我们很早就学习过了，其本质就是找到一个方程去拟合一个数据的变换情况，假设方程是这个</p>
<p><code>y=X * w （x，w均为向量，y就是向量的内积）</code></p>
<p>那么如何去判断这个函数与实际是否贴切？那我们就要计算真实值与预测值之间的误差总值</p>
<p><code>error=sum{(y_true[i] - y_pre[i])^2}</code></p>
<p>error的值域为零到正无穷，当error等于0时，我们说这个方程就是这个数据的表现，当error很大时，我们的这个方程并不能体现这个数据的变化。因此，我们希望我们的error越小越好，这个减小error的过程就是机器学习的过程。</p>
<blockquote>
<p>线性回归</p>
</blockquote>
<p>这个线性回归是最简单的回归算法了，其方程我们就是认为是一次方程<code>y=x * w</code>，所以，该算法的最终目标就是解出<code>w</code>这个参数向量来。这里，<code>x</code>是特征向量矩阵，<code>w</code>是每个特征对应的权重矩阵；误差总值计算为<code>sum{(y_true[i] - x[i].T * w)^2}</code>，因此，最终w的计算公式为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w = (x.T * x)^-1 * x.T * y</span><br></pre></td></tr></table></figure>
<p>代码计算实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> linalg <span class="keyword">as</span> la</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">standRegres</span><span class="params">(xArr, yArr)</span>:</span></span><br><span class="line">	xMat = np.mat(xArr); yMat = np.mat(yArr).T</span><br><span class="line">	xTx = xMat.T * xMat</span><br><span class="line">	<span class="keyword">if</span> la.det(xTx) == <span class="number">0.0</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"该矩阵不能求逆"</span></span><br><span class="line">	ws = xTx * (xMat.T * yMat)</span><br><span class="line">	<span class="keyword">return</span> ws</span><br></pre></td></tr></table></figure>
<blockquote>
<p>局部加权线性回归</p>
</blockquote>
<p>线性回归的计算非常简单，但是简单也有简单的坏处——线性回归只能大概的描述数据的趋势，再细一些的数据变化，基本的线性回归是没办法解决的。比如这幅图：</p>
<p><img src="http://120.24.90.180/blog/image/machine_learning/machine-learning-5.1.png" alt="machine-learning-5.1.png"></p>
<p>如果只是用线性回归去预测，那么我们只能得到一条描述数据呈上升趋势的直线，其中转折点的数据情况则没办法，这个时候就有局部加权线性回归的方法。局部加权线性回归是为待预测点附近的点进行加权判断与待预测点是否属于一个线性回归模型中，这样，就在最开始的线性回归模型预测中进一步提取信息，在每一个子集中提取各自的线性回归模型，然后组合成为最后的线性回归模型。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">w = (x.T * W * x)^-1 * x.T * W * y，（W是权重矩阵，w是回归系数矩阵）</span><br><span class="line"></span><br><span class="line">W = exp&#123;|x[i] - x| / (-2 * k^2)&#125;，（加权计算公式）</span><br></pre></td></tr></table></figure>
<p>加权公式中，除了k是我们认为设置的之外，其余都是已知的代入求值。<code>x[i] - x</code>是用于求误差值，误差值越大，表明待预测点并不属于当前的线性回归模式，那么对应的加权就会更小，反之误差值越小，越属于当前的线性回归模式，对应的加权就会越大；而k，是局部加权线性回归中的局部子集的大小，如果k越大，那么就会变成最开始的线性回归模型，如果k越小，那么局部子集也就越小，线性回归模型就会过度拟合数据，无法完全描述出数据的变化趋势，因此，k存在最优质，这个就需要我们人工去调整，去尽可能的找到这个最优的k值。</p>
<p>代码实现局部加权线性回归</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lwlr</span><span class="params">(testPoint, xArr, yArr, k=<span class="number">1.0</span>)</span>:</span></span><br><span class="line">	xMat = np.mat(xArr); yMat = np.mat(yArr).T</span><br><span class="line">	m = np.shape(xMat)[<span class="number">0</span>]</span><br><span class="line">	weights = np.mat(np.eye(m))</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">		diffMat = testPoint - xMat[j, :]</span><br><span class="line">		weights[j, j] = np.exp(diffMat * diffMat.T / (<span class="number">-2.0</span> * K ** <span class="number">2</span>))</span><br><span class="line">	xTx = xMat.T * (weights * xMat)</span><br><span class="line">	<span class="keyword">if</span> np.linalg.det(xTx) == <span class="number">0.0</span>:</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	ws = xTx.T * (xMat.T * (weights * yMat))</span><br><span class="line">	<span class="keyword">return</span> testPoint * ws</span><br></pre></td></tr></table></figure>
<blockquote>
<p>岭回归</p>
</blockquote>
<p>回归参数w的计算公式中，x是特征值矩阵，在前面的计算中都有一步求矩阵的逆矩阵，如果特征数超过样本数，那么x矩阵就不是一个满秩矩阵，因此，逆矩阵也就无法求得了，这个时候，我们就需要判断：是否真的需要这么多特征参与回归计算？显然，我们可以猜到有一些特征是不需要参与回归计算的，那么我们就可以“缩减”特征矩阵。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w = (x.T * x + lambda * I)^-1 * x.T * y，其中，I是单位矩阵，lambda用于限制w的总和，可以理解为lambda * I为惩罚项，惩罚那些不必要的特征以达到缩减目的。</span><br></pre></td></tr></table></figure>
<p>代码实现计算过程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ridgeRegress</span><span class="params">(xMat, yMat, lam=<span class="number">0.2</span>)</span>:</span></span><br><span class="line">	xTx = xMat.T * xMat</span><br><span class="line">	denom = xTx + np.eye(np.shape(xMat)[<span class="number">1</span>]) * lam</span><br><span class="line">	<span class="keyword">if</span> np.linalg.det(denom) == <span class="number">0.0</span>:</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	ws = denom.I * (xMat.T * yMat)</span><br><span class="line">	<span class="keyword">return</span> ws</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ridgeRegressTest</span><span class="params">(xArr, yArr)</span>:</span></span><br><span class="line">	xMat, yMat = np.mat(xArr), np.mat(yArr).T</span><br><span class="line">	yMean = np.mean(yMat, <span class="number">0</span>)</span><br><span class="line">	yMat = yMat - yMean</span><br><span class="line">	xMeans = np.mean(xMat, <span class="number">0</span>)</span><br><span class="line">	xVar = np.var(xMat, <span class="number">0</span>)</span><br><span class="line">	numTestPts = <span class="number">30</span></span><br><span class="line">	wMat = np.zeros((numTestPts, np.shape(xMat)[<span class="number">1</span>]))</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(numTestPts):</span><br><span class="line">		ws = ridgeRegress(xMat, yMat, np.exp(i - <span class="number">10</span>))</span><br><span class="line">		wMat[i, :] = ws.T</span><br><span class="line">	<span class="keyword">return</span> wMat</span><br></pre></td></tr></table></figure>
<blockquote>
<p>前向逐步回归</p>
</blockquote>
<p>前向逐步回归可以说是岭回归的加强算法，前向逐步回归是一种贪心算法：对每一种特征进行调整来进行回归计算，然后判断该特征对于最终回归结果的影响，如果回归预测误差小于上一步得到的误差，那么就更新误差值，并且更新回归参数向量w。其最终目标就是缩减预测值与真实值之间的误差。·</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rssError</span><span class="params">(yMat_true, yMat_test)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> np.sum(np.abs(yMat_test - yMat_true))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">regularize</span><span class="params">(xMat)</span>:</span></span><br><span class="line">    xMeans = np.mean(xMat, <span class="number">0</span>)</span><br><span class="line">    xVar = np.var(xMat, <span class="number">0</span>)</span><br><span class="line">    xMat = (xMat - xMeans) / xVar</span><br><span class="line">    <span class="keyword">return</span> xMat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stageWise</span><span class="params">(xArr, yArr, esp=<span class="number">0.01</span>, numIt=<span class="number">100</span>)</span>:</span></span><br><span class="line">    xMat = np.mat(xArr);</span><br><span class="line">    yMat = np.mat(yArr).T</span><br><span class="line">    yMean = np.mean(yMat, <span class="number">0</span>)</span><br><span class="line">    yMat -= yMean</span><br><span class="line">    xMat = regularize(xMat)</span><br><span class="line">    m, n = np.shape(xMat)</span><br><span class="line">    returnMat = np.zeros((numIt, n))</span><br><span class="line">    ws = np.zeros((n, <span class="number">1</span>));</span><br><span class="line">    wsTest = ws.copy();</span><br><span class="line">    wsMax = ws.copy()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(numIt):</span><br><span class="line">        print(ws.T)</span><br><span class="line">        lowestError = np.inf</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> sign <span class="keyword">in</span> [<span class="number">-1</span>, <span class="number">1</span>]:</span><br><span class="line">                wsTest = ws.copy()</span><br><span class="line">                wsTest[j] += esp * sign</span><br><span class="line">                yTest = xMat * wsTest</span><br><span class="line">                rssE = rssError(yMat.A, yTest.A)</span><br><span class="line">                <span class="keyword">if</span> rssE &lt; lowestError:</span><br><span class="line">                    lowestError = rssE</span><br><span class="line">                    wsMax = wsTest</span><br><span class="line">        ws = wsMax.copy()</span><br><span class="line">        returnMat[i, :] = ws.T</span><br><span class="line">    <span class="keyword">return</span> returnMat</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/09/deep-learning-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/09/deep-learning-3/" itemprop="url">
                  记一次竞赛题目有感——根据姓名预测男女性别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-09 16:29:14" itemprop="dateCreated datePublished" datetime="2018-02-09T16:29:14+08:00">2018-02-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-04-26 12:07:57" itemprop="dateModified" datetime="2018-04-26T12:07:57+08:00">2018-04-26</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/深度学习/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>比赛连接 sofasofa.io</p>
</blockquote>
<p><a href="http://sofasofa.io/competition.php?id=3" target="_blank" rel="noopener">根据姓名预测男女性别</a></p>
<p>今天尝试着做了一道机器学习题——根据姓名预测男女性别。这道题目其实算法就是二分类的题目，这类算法很多，比如knn近邻算法，决策树，svm向量机等等；传统的机器学习算法可以达到百分之七十到百分之八十五之间，我想能不能用深度学习来做一下看看能达到多高的accuracy率。</p>
<blockquote>
<p>我们每天会接触不同的人，有热情的面孔，也有冰冷的名片。作为一个说着中国话的中国人，我们有着常年累月的积累和对文字的理解，通过名字判断（猜测）性别，并非难事。可是，对于一个冰冷的机器，它能够根据名字判断性别吗？这个练习赛就是根据中文名字（姓已经省略），判断性别 </p>
</blockquote>
<p>竞赛题目</p>
<blockquote>
<p>竞赛题目数据截图</p>
</blockquote>
<p><img src="http://120.24.90.180/blog/image/deep_learning/deep_learning-3.1.png" alt="数据截图"></p>
<p>其实这道题就是一个二分类，跟之前做的识别方圆的题目是一个类型的，只不过从图片转为了文本二分类而已。那么，现在有一个问题，这里给出的是中文名字数据，这样的数据是没办法直接进入模型的，因此还需要进行数据处理；如何将中文汉字转为深度学习模型可以处理的数据就是这道题的一个难点。在这里，我采用的将中文汉字转为Unicode编码后在转为二进制的文本向量的方式来处理。利用python的ord()函数和bin()函数将汉字转为二进制的编码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">FILL_NAME = [[<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>],</span><br><span class="line">             [<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>],</span><br><span class="line">             [<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2bin</span><span class="params">(user_name)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param user_name:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> [map(int, bin(ord(i))[<span class="number">2</span>:]) <span class="keyword">for</span> i <span class="keyword">in</span> user_name[<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">listExtend</span><span class="params">(List)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param List:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    a = []</span><br><span class="line">    <span class="keyword">if</span> len(List) == <span class="number">3</span>:</span><br><span class="line">        List.extend(FILL_NAME)</span><br><span class="line">        [a.extend(i) <span class="keyword">for</span> i <span class="keyword">in</span> List]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        [a.extend(i) <span class="keyword">for</span> i <span class="keyword">in</span> List]</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_data_dense</span><span class="params">(fileName_train=FILE_TRAIN_PATH, fileName_test=FILE_TEST_PATH)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param fileName_train:</span></span><br><span class="line"><span class="string">    :param fileName_test:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    train, test = np.array(pd.read_csv(fileName_train).values), np.array(pd.read_csv(fileName_test).values)</span><br><span class="line">    train_name, test_name, train_sex, test_sex = train_test_split(train[:, <span class="number">1</span>:<span class="number">2</span>], train[:, <span class="number">2</span>], test_size=<span class="number">0.2</span>)</span><br><span class="line">    train_name, test_name = map(str2bin, train_name), map(str2bin, test_name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name2vec</span><span class="params">(names)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> np.array(map(listExtend, names))</span><br><span class="line"></span><br><span class="line">    train_name = name2vec(train_name);</span><br><span class="line">    test_name = name2vec(test_name)</span><br><span class="line">    <span class="keyword">print</span> train_name, <span class="string">'\n'</span>, np.shape(train_name)</span><br><span class="line">    <span class="keyword">return</span> train_name, train_sex, test_name, test_sex</span><br></pre></td></tr></table></figure>
<blockquote>
<p>转换结果</p>
</blockquote>
<p><img src="http://120.24.90.180/blog/image/deep_learning/deep_learning-3.2.png" alt="word2vec"></p>
<p>既然我们已经将汉字转为了向量之后，那下一步就是构建一个深度学习模型用于二分类了。关于如何构建二分类的深度学习模型，在判断奇偶数的篇章中已经给出了。</p>
<h4 id="简单的全连接深度学习模型"><a href="#简单的全连接深度学习模型" class="headerlink" title="简单的全连接深度学习模型"></a>简单的全连接深度学习模型</h4><blockquote>
<p>模型代码</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_model_dense</span><span class="params">(train_x)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    :param train_x:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    inputs = Input(shape=(train_x.shape[<span class="number">1</span>],))</span><br><span class="line">    x_dense_1 = Dense(units=<span class="number">64</span>, activation=<span class="string">'relu'</span>, use_bias=<span class="keyword">True</span>)(inputs)</span><br><span class="line">    x_dropout_1 = Dropout(rate=<span class="number">0.1</span>)(x_dense_1)</span><br><span class="line">    x_dense_2 = Dense(units=<span class="number">256</span>, activation=<span class="string">'relu'</span>, use_bias=<span class="keyword">True</span>)(x_dropout_1)</span><br><span class="line">    x_dropout_2 = Dropout(rate=<span class="number">0.1</span>)(x_dense_2)</span><br><span class="line">    x_dense_3 = Dense(units=<span class="number">128</span>, activation=<span class="string">'relu'</span>, use_bias=<span class="keyword">True</span>)(x_dropout_2)</span><br><span class="line">    predictions = Dense(units=<span class="number">1</span>, activation=<span class="string">'tanh'</span>)(x_dense_3)</span><br><span class="line">    model = Model(inputs=inputs, outputs=predictions)</span><br><span class="line">    model.compile(loss=<span class="string">'binary_crossentropy'</span>,</span><br><span class="line">                  optimizer=<span class="string">'adam'</span>,</span><br><span class="line">                  metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">    model.summary()</span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_model</span><span class="params">(batch_size=<span class="number">32</span>, verbose=<span class="number">2</span>, validation_split=<span class="number">0.1</span>, model=None, type=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param batch_size:</span></span><br><span class="line"><span class="string">    :param verbose:</span></span><br><span class="line"><span class="string">    :param validation_split:</span></span><br><span class="line"><span class="string">    :param model:</span></span><br><span class="line"><span class="string">    :param type:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> model <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">"model is None"</span>)</span><br><span class="line">    train_name, train_sex, test_name, test_sex = ld.load_data(type)</span><br><span class="line">    history = model.fit(train_name, train_sex,</span><br><span class="line">                        batch_size=batch_size,</span><br><span class="line">                        validation_split=validation_split,</span><br><span class="line">                        epochs=<span class="number">50</span>,</span><br><span class="line">                        verbose=verbose)</span><br><span class="line">    plt.plot(history.history[<span class="string">'loss'</span>], label=<span class="string">'train'</span>)</span><br><span class="line">    plt.plot(history.history[<span class="string">'val_loss'</span>], label=<span class="string">'test'</span>)</span><br><span class="line">    plt.legend()</span><br><span class="line">    plt.show()</span><br><span class="line">    score = model.evaluate(test_name, test_sex,</span><br><span class="line">                           batch_size=batch_size)</span><br><span class="line">    print(score)</span><br></pre></td></tr></table></figure>
<p>那么这个模型的结果如何呢？跑一跑就知道了</p>
<blockquote>
<p>模型训练/测试的损失函数值变化情况</p>
</blockquote>
<p><img src="http://120.24.90.180/blog/image/deep_learning/deep_learning-3.3.png" alt="loss_data"></p>
<blockquote>
<p>模型二分类结果</p>
</blockquote>
<p><img src="http://120.24.90.180/blog/image/deep_learning/deep_learning-3.4.png" alt="binary_classify"></p>
<p>可以看出，模型的二分类准确率为百分之78～79，将近百分之80，因此这个模型的accuracy还是可以接受的。但是，跟传统的机器学习相比，百分之78～79的正确率有点不尽人意。那么，如何提高深度学习的accuracy呢？</p>
<h4 id="多输入单输出的深度学习模型（accuracy为百分之81-xx）"><a href="#多输入单输出的深度学习模型（accuracy为百分之81-xx）" class="headerlink" title="多输入单输出的深度学习模型（accuracy为百分之81.xx）"></a>多输入单输出的深度学习模型（accuracy为百分之81.xx）</h4><p>观察训练数据可以看出，名字要么是由两个字组成的，要么就是单个字；而两个字组成的名字，而每个字对应男女的可能性都有所不同，我们可以认为两个字共同影响最终性别的取向，因此可以将名字拆分，分别进行学习{字-&gt;性别}的映射，然后将映射组合起来，再进行两个字对性别综合影响的学习。</p>
<blockquote>
<p>模型图</p>
</blockquote>
<p><img src="http://120.24.90.180:8080/blog/image/deep_learning/deep_learning-3.5.png" alt="多输入单输出的深度学习模型"></p>
<p>每一个字进入一个神经网络进行学习字与性别的关系，分别为a_name和b_name，通过神经网络学习到了a_name与性别的特征向量encode_1、b_name与性别的特征向量encode_2；然后通过keras.layers.concatenate将学习到的特征向量组合成一个新的特征向量，再进行一次神经网络的学习。</p>
<blockquote>
<p>模型代码</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_model</span><span class="params">()</span>:</span></span><br><span class="line">    a_name = Input(shape=(<span class="number">24</span>,))</span><br><span class="line">    a_dense_1 = Dense(units=<span class="number">48</span>, activation=<span class="string">'relu'</span>)(a_name)</span><br><span class="line">    a_dropout = Dropout(rate=<span class="number">0.2</span>)(a_dense_1)</span><br><span class="line">    a_dense_2 = Dense(units=<span class="number">96</span>, activation=<span class="string">'relu'</span>)(a_dropout)</span><br><span class="line">    encode_1 = Dense(units=<span class="number">24</span>, activation=<span class="string">'relu'</span>)(a_dense_2)</span><br><span class="line"></span><br><span class="line">    b_name = Input(shape=(<span class="number">24</span>,))</span><br><span class="line">    b_dense_1 = Dense(units=<span class="number">48</span>, activation=<span class="string">'relu'</span>)(b_name)</span><br><span class="line">    b_dropout = Dropout(rate=<span class="number">0.2</span>)(b_dense_1)</span><br><span class="line">    b_dense_2 = Dense(units=<span class="number">96</span>, activation=<span class="string">'relu'</span>)(b_dropout)</span><br><span class="line">    encode_2 = Dense(units=<span class="number">24</span>, activation=<span class="string">'relu'</span>)(b_dense_2)</span><br><span class="line"></span><br><span class="line">    inputs = concatenate([encode_1, encode_2], axis=<span class="number">-1</span>)</span><br><span class="line">    x_dense_1 = Dense(units=<span class="number">96</span>, activation=<span class="string">'relu'</span>, use_bias=<span class="keyword">True</span>)(inputs)</span><br><span class="line">    x_dropout_1 = Dropout(rate=<span class="number">0.1</span>)(x_dense_1)</span><br><span class="line">    x_dense_2 = Dense(units=<span class="number">192</span>, activation=<span class="string">'relu'</span>, use_bias=<span class="keyword">True</span>)(x_dropout_1)</span><br><span class="line">    x_dropout_2 = Dropout(rate=<span class="number">0.1</span>)(x_dense_2)</span><br><span class="line">    x_dense_3 = Dense(units=<span class="number">96</span>, activation=<span class="string">'relu'</span>, use_bias=<span class="keyword">True</span>)(x_dropout_1)</span><br><span class="line">    predictions = Dense(units=<span class="number">1</span>, activation=<span class="string">'sigmoid'</span>, name=<span class="string">'out_put'</span>)(x_dense_3)</span><br><span class="line"></span><br><span class="line">    model = Model(inputs=[a_name, b_name], outputs=predictions)</span><br><span class="line">    model.compile(loss=<span class="string">'binary_crossentropy'</span>,</span><br><span class="line">                  optimizer=<span class="string">'adam'</span>,</span><br><span class="line">                  metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">    model.summary()</span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_model</span><span class="params">(batch_size=<span class="number">64</span>, verbose=<span class="number">2</span>, validation_split=<span class="number">0.1</span>, type=<span class="string">'dense'</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param batch_size:</span></span><br><span class="line"><span class="string">    :param verbose:</span></span><br><span class="line"><span class="string">    :param validation_split:</span></span><br><span class="line"><span class="string">    :param type:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    train_name, train_sex, test_name, test_sex = ld.load_data(type=type)</span><br><span class="line">    model = build_model()</span><br><span class="line">    history = model.fit([train_name[:, <span class="number">0</span>: <span class="number">24</span>], train_name[:, <span class="number">24</span>:]], train_sex,</span><br><span class="line">                        batch_size=batch_size,</span><br><span class="line">                        validation_split=validation_split,</span><br><span class="line">                        epochs=<span class="number">50</span>,</span><br><span class="line">                        verbose=verbose)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>模型训练/测试的损失函数值的变化情况</p>
</blockquote>
<p><img src="http://120.24.90.180:8080/blog/image/deep_learning/deep_learning-3.6.png" alt="模型训练/测试的损失函数值的变化情况"></p>
<blockquote>
<p>模型对测试集的预测情况</p>
</blockquote>
<p><img src="http://120.24.90.180:8080/blog/image/deep_learning/deep_learning-3.7.png" alt="模型对测试集的预测情况"></p>
<blockquote>
<p>模型展示与训练(视频)</p>
</blockquote>
<p><img src="" alt="bilibili"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/07/machine-learning-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/07/machine-learning-4/" itemprop="url">
                  机器学习之Logistic回归
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-07 17:41:53" itemprop="dateCreated datePublished" datetime="2018-02-07T17:41:53+08:00">2018-02-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-05-06 10:48:21" itemprop="dateModified" datetime="2018-05-06T10:48:21+08:00">2018-05-06</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/机器学习/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前说了利用knn，决策树，朴素贝叶斯来实现分类的机器学习算法，各有优缺点；这次学习了新的用于分类的机器学习算法——Logistic回归的分类算法</p>
<p>Logistic算法最重要的就是为现有的数据集建立回归公式，得到回归直线，举一个例子：</p>
<p><img src="http://120.24.90.180/blog/image/machine_learning/machine-learning-4.1.png" alt="machine-learning-4.1"></p>
<p>上图就是一个典型的Logistic分类的应用，图中蓝色矩形色块和红色圆形色块是两个不同的类别，图中的直线就是一条回归直线。可以看到这条直线将蓝色矩形色块和红色圆形色块分割开来了，如果这个看作是一个分类问题的话，那么位于直线上方的点归类到蓝色矩形色块中，位于直线下方的点可以归类到红色圆形色块中，而这条回归直线，就是分类标准，而得到这条直线的过程，就是所要说的Logistic回归了。</p>
<blockquote>
<p>Logistic回归</p>
</blockquote>
<p>回归，也可以称作最佳拟合，就拿上面的例子说，希望找到一条最好的直线能够最大化的区分蓝色矩形色块与红色圆形色块，那么这条回归直线的参数就是所需要求的，并且希望得到一组最优参数，使得得到的直线是最优拟合的直线。</p>
<blockquote>
<p>sigmoid函数</p>
</blockquote>
<p>sigmoid(z) = 1 / (1 + exp(-z)) {z = w0 <em> x + w1 </em> x + w2 <em> x + … + wn </em> x}，这是sigmoid函数的表达式，z是自变量，z的表示式就是花括号里面的式子；sigmoid函数常用于二分类当中，这是由于sigmoid函数图像决定的，sigmoid函数的值域是(0, 1)，0处的取值是0.5，所以对于二分类来说，如果sigmoid函数的值小于0.5，就归类于第一个分类，否则就归类于第二个分类。</p>
<p><img src="http://120.24.90.180/blog/image/machine_learning/machine-learning-4.2.png" alt="machine-learning-4.2"></p>
<p>在sigmoid函数的z变量的表示式中，看到了这个式子：z = w0 <em> x + w1 </em> x + w2 <em> x + … + wn </em> x；这里的x，就是向分类器中输入的事物的特征值，而w0，w1，w2，…，wn，则是参数，这些个参数，就是需要求的最优参数了。但是这个w参数，有什么意义呢？重新看这个z自变量的表达式：x是事物的特征值，既然是要做分类，那么肯定是需要参考事物的特征来实现分类的，但是事物的特征有很多，到底该用哪些特征来作为分类的依据呢？w参数就是做这个的，每种特征对应一个特征的权重wi，wi的大小决定了这个特征是否是用于分类的重要特征，所以，又可以知道，w参数的个数与事物的特征数目有关。接下来，就是如何去求解这么多个特征的权重参数wi了。</p>
<blockquote>
<p>梯度下降（上升）法</p>
</blockquote>
<p>如何求解多个参数的最优值，普遍的做法是采用梯度下降（上升）法来求解。梯度下降（上升）法是用于求解凹（凸）函数的最大（小）值的方法，到这里可能会有疑惑，梯度是什么？梯度实际上就是高等数学里面的对函数的每个自变量求偏导数，然后这些偏导数和起来组成的向量就是梯度，用更专业一点的话说：表示某一函数在该点处的方向导数沿着该方向取得最大值，即函数在该点处沿着该方向（此梯度的方向）变化最快，变化率最大（为该梯度的模）。 所以，只需要沿着梯度的方向，就能够快速接近函数的最大（小）值。</p>
<p><img src="http://120.24.90.180/blog/image/machine_learning/machine-learning-4.3.png" alt="machine-learning-4.3.png"></p>
<p>所以，Logistic回归可以说是求一组特征权重的过程，特征权重的好与坏直接影响到最终分类的好坏，并且，Logistic回归最核心的部分，就是如何求的特征权重的取值，现在来看看代码是如何实现Logistic回归算法的。</p>
<blockquote>
<p>代码实现</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadDataSet</span><span class="params">()</span>:</span></span><br><span class="line">    dataMat = []</span><br><span class="line">    labelMat = []</span><br><span class="line">    fr = open(<span class="string">'testSet.txt'</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> fr.readlines():</span><br><span class="line">        lineArr = line.strip().split()</span><br><span class="line">        <span class="comment"># 提取特征值</span></span><br><span class="line">        dataMat.append([<span class="number">1.0</span>, float(lineArr[<span class="number">0</span>]), float(lineArr[<span class="number">1</span>])])</span><br><span class="line">        labelMat.append(int(lineArr[<span class="number">2</span>]))</span><br><span class="line">    <span class="keyword">return</span> dataMat, labelMat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span><span class="params">(inX)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1.0</span> / (<span class="number">1</span> + np.exp(-inX))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gradAscent</span><span class="params">(dataMatIn, classLabels)</span>:</span></span><br><span class="line">    dataMatrix = np.mat(dataMatIn)</span><br><span class="line">    labelMat = np.mat(classLabels).transpose()</span><br><span class="line">    m, n = np.shape(dataMatrix)</span><br><span class="line">    alpha = <span class="number">0.001</span></span><br><span class="line">    maxCycles = <span class="number">500</span></span><br><span class="line">    weights = np.ones((n, <span class="number">1</span>))</span><br><span class="line">    <span class="comment"># 实现梯度上升算法</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(maxCycles):</span><br><span class="line">        h = sigmoid(dataMatrix * weights)</span><br><span class="line">        error = labelMat - h</span><br><span class="line">        <span class="comment"># 更新权重wi</span></span><br><span class="line">        weights = weights + alpha * dataMatrix.transpose() * error</span><br><span class="line">    <span class="keyword">return</span> weights</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    dataMatIn, classLabels = loadDataSet()</span><br><span class="line">    print(gradAscent(dataMatIn, classLabels))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>样本示例</p>
</blockquote>
<p><img src="http://120.24.90.180/blog/image/machine_learning/machine-learning-4.4.png" alt="machine-learning-4.4"></p>
<blockquote>
<p>结果</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/python /Volumes/Extended/code/PythonProject/maching-learning/Logistic/Logistic.py</span><br><span class="line">[[ 4.12414349]</span><br><span class="line"> [ 0.48007329]</span><br><span class="line"> [-0.6168482 ]]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>最终的回归线与样本展示</p>
</blockquote>
<p>最后我们求的权重参数是三个维度，每一种特征对应一个特征权重。在函数gradascent中实现了梯度上升的算法。我们在循环中看到，每次都是运算整个样本量进行更新权重参数wi，并且是经过500轮的计算，虽然样本测试得出结果的速度非常快，但是对于实际操作中，样本容量动不动就是千万甚至亿级的样本量，这样的计算量就显得非常庞大了。这个时候，就要改进下梯度上升（下降）算法了——采用随机梯度上升（下降）算法。</p>
<blockquote>
<p>改进的梯度上升（下降）算法</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gradAscent</span><span class="params">(dataMatIn, classLabels)</span>:</span></span><br><span class="line">    dataMatrix = np.mat(dataMatIn)</span><br><span class="line">    labelMat = np.mat(classLabels).transpose()</span><br><span class="line">    m, n = np.shape(dataMatrix)</span><br><span class="line">    alpha = <span class="number">0.001</span></span><br><span class="line">    weights = np.ones(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">        h = sigmoid(np.sum(dataMatrix[i] * weights))</span><br><span class="line">        error = labelMat[i] - h</span><br><span class="line">        weights = weights + alpha * dataMatrix[i] * error</span><br><span class="line">    <span class="keyword">return</span> weights</span><br></pre></td></tr></table></figure>
<p>我们对样本每一次取等量的一部分进行更新特征取值，这样就减少了每一次更新特征权重所需的计算量大小</p>
<blockquote>
<p>优化后的随机梯度上升计算结果</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/python /Volumes/Extended/code/PythonProject/maching-learning/Logistic/Logistic.py</span><br><span class="line">[ 1.01702007  0.85914348 -0.36579921]</span><br></pre></td></tr></table></figure>
<p>可以看出，随机梯度上升计算的结果跟梯度上升计算的结果相差很大，原因是随机梯度上升（下降）算法虽然相比梯度上升（下降）算法减少了更多的计算量，但是却无法到达函数的最大（小）值点，只能在附近动荡，因此，我们还需要在稍稍优化下随机梯度上升（下降）算法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stocGradAscent1</span><span class="params">(dataMatrix, classLabels, numIter=<span class="number">150</span>)</span>:</span></span><br><span class="line">    m, n = shape(dataMatrix)</span><br><span class="line">    weights = ones(n)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(numIter):</span><br><span class="line">        dataIndex = range(m)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            alpha = <span class="number">4</span> / (<span class="number">1.0</span> + j + i) + <span class="number">0.0001</span></span><br><span class="line">            randIndex = int(random.uniform(<span class="number">0</span>, len(dataIndex)))</span><br><span class="line">            h = sigmoid(sum(dataMatrix[randIndex] * weights))</span><br><span class="line">            error = classLabels[randIndex] - h</span><br><span class="line">            weights = weights + alpha * error * dataMatrix[randIndex]</span><br><span class="line">            <span class="keyword">del</span> (dataIndex[randIndex])</span><br><span class="line">    <span class="keyword">return</span> weights</span><br></pre></td></tr></table></figure>
<blockquote>
<p>计算结果</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/python /Volumes/Extended/code/PythonProject/maching-learning/Logistic/Logistic.py</span><br><span class="line">[13.19641216  1.05126524 -1.73315744]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>结果可视化</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plotBestFit</span><span class="params">(weights)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">    dataMat,labelMat=loadDataSet()</span><br><span class="line">    dataArr = array(dataMat)</span><br><span class="line">    n = shape(dataArr)[<span class="number">0</span>] </span><br><span class="line">    xcord1 = []; ycord1 = []</span><br><span class="line">    xcord2 = []; ycord2 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        <span class="keyword">if</span> int(labelMat[i])== <span class="number">1</span>:</span><br><span class="line">            xcord1.append(dataArr[i,<span class="number">1</span>]); ycord1.append(dataArr[i,<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            xcord2.append(dataArr[i,<span class="number">1</span>]); ycord2.append(dataArr[i,<span class="number">2</span>])</span><br><span class="line">    fig = plt.figure()</span><br><span class="line">    ax = fig.add_subplot(<span class="number">111</span>)</span><br><span class="line">    ax.scatter(xcord1, ycord1, s=<span class="number">30</span>, c=<span class="string">'red'</span>, marker=<span class="string">'s'</span>)</span><br><span class="line">    ax.scatter(xcord2, ycord2, s=<span class="number">30</span>, c=<span class="string">'green'</span>)</span><br><span class="line">    x = arange(<span class="number">-3.0</span>, <span class="number">3.0</span>, <span class="number">0.1</span>)</span><br><span class="line">    y = (-weights[<span class="number">0</span>]-weights[<span class="number">1</span>]*x)/weights[<span class="number">2</span>]</span><br><span class="line">    ax.plot(x, y)</span><br><span class="line">    plt.xlabel(<span class="string">'X1'</span>); plt.ylabel(<span class="string">'X2'</span>);</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="http://120.24.90.180/blog/image/machine_learning/machine-learning-4.5.png" alt="machine-learning-4.5.png"></p>
<blockquote>
<p>source code</p>
</blockquote>
<p><a href="https://github.com/chuntaojun/machine-learning-pr/tree/master/Logistic" target="_blank" rel="noopener">https://github.com/chuntaojun/machine-learning-pr/tree/master/Logistic</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/01/machine-learning-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/01/machine-learning-3/" itemprop="url">
                  机器学习之朴素贝叶斯
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-01 16:50:13 / Modified: 21:03:47" itemprop="dateCreated datePublished" datetime="2018-02-01T16:50:13+08:00">2018-02-01</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/机器学习/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>分类算法有前面说的knn和决策树，这两个算法中，决策树是knn的优化版，因为knn算法虽然是实现分类的万金油算法，但是它的计算量太庞大；而决策树又不容易分类成功，泛化能力弱以及容易过拟合。因此，今天学习了利用概率来实现分类的入门算法——朴素贝叶斯。</p>
<p>朴素贝叶斯最重要的就是条件概率，那么什么是条件概率？</p>
<blockquote>
<p>条件概率</p>
</blockquote>
<p>p(A|B) = p(A &amp; B) / p(B)，意思是指在B条件下发生A事件的概率；举一个例子，假设有十个小球：四个白的，六个黑的。如果都放到一个黑箱子中，取到白球的概率是2/5，取到黑球的概率是3/5；如果现在有两个箱子A.B，A箱子中有五个球：三个白球两个黑球；B箱子中有五个球：一个白球四个黑球；那么，我取到B箱子中黑球的概率是多少？这就是一个典型的条件概率事件。我们可以这样算：用B箱子中的黑球个数除以总的球数得到pa，然后在用B箱子中的总球数除以总球数得到pb，然后只需要用pa/pb就可以得出最后我们要求的概率</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pa = <span class="number">1</span> / <span class="number">10</span>; pb = <span class="number">5</span> / <span class="number">10</span>; p(黑球|B箱子) = pa / pb = <span class="number">1</span> / <span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<p>那么朴素贝叶斯是怎么计算条件概率的呢？这里有一个贝叶斯准则</p>
<blockquote>
<p>贝叶斯准则</p>
</blockquote>
<p>如果要求(c|x)，已知p(x|c)，那么可以这样求得p(c|x)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p(x|c) = (p(x|c) * p(c)) / p(x)</span><br></pre></td></tr></table></figure>
<p>如果我们把 c 看作是类别，而 x 是待分类的，最终确定x的分类是通过比较p(x|c1), p(x|c2), p(x|c3) … p(x|cn)的条件概率的大小，取概率最大值对应的分类为x的最终分类结果</p>
<p>现在，通过留言处理是否是侮辱性留言来深刻理解下朴素贝叶斯算法</p>
<p>首先我们先人为创建一个留言样本</p>
<blockquote>
<p>我们规定 classVec[i]的值为0的是侮辱性的留言；</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadDataSet</span><span class="params">()</span>:</span></span><br><span class="line">    postingList = [[<span class="string">'my'</span>, <span class="string">'dog'</span>, <span class="string">'has'</span>, <span class="string">'flea'</span>, <span class="string">'problems'</span>, <span class="string">'help'</span>, <span class="string">'please'</span>],</span><br><span class="line">                   [<span class="string">'maybe'</span>, <span class="string">'not'</span>, <span class="string">'take'</span>, <span class="string">'him'</span>, <span class="string">'to'</span>, <span class="string">'dog'</span>, <span class="string">'park'</span>, <span class="string">'stupid'</span>],</span><br><span class="line">                   [<span class="string">'my'</span>, <span class="string">'dalmation'</span>, <span class="string">'is'</span>, <span class="string">'so'</span>, <span class="string">'cute'</span>, <span class="string">'I'</span>, <span class="string">'love'</span>, <span class="string">'him'</span>],</span><br><span class="line">                   [<span class="string">'stop'</span>, <span class="string">'posting'</span>, <span class="string">'stupid'</span>, <span class="string">'worthless'</span>, <span class="string">'garbage'</span>],</span><br><span class="line">                   [<span class="string">'mr'</span>, <span class="string">'licks'</span>, <span class="string">'ate'</span>, <span class="string">'my'</span>, <span class="string">'steak'</span>, <span class="string">'how'</span>, <span class="string">'to'</span>, <span class="string">'stop'</span>, <span class="string">'him'</span>],</span><br><span class="line">                   [<span class="string">'quit'</span>, <span class="string">'buying'</span>, <span class="string">'worthless'</span>, <span class="string">'dog'</span>, <span class="string">'food'</span>, <span class="string">'stupid'</span>]]</span><br><span class="line">    classVec = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> postingList, classVec</span><br></pre></td></tr></table></figure>
<p>接着，我们需要将这些留言中的单词提取出来放到一张词汇表中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createVocabList</span><span class="params">(dataSet)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    创建单词字典</span></span><br><span class="line"><span class="string">    :param dataSet:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    vocabSet = set([])</span><br><span class="line">    <span class="keyword">for</span> document <span class="keyword">in</span> dataSet:</span><br><span class="line">        vocabSet = vocabSet | set(document)</span><br><span class="line">    <span class="keyword">return</span> list(vocabSet)</span><br></pre></td></tr></table></figure>
<p>然后，我们有两条留言（假设我们的词汇表已经很大，留言的词汇都在我们的词汇表中）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">testEntry_1 = [<span class="string">'love'</span>, <span class="string">'my'</span>, <span class="string">'dalmation'</span>]</span><br><span class="line">testEntry_2 = [<span class="string">'stupid'</span>, <span class="string">'garbage'</span>]</span><br></pre></td></tr></table></figure>
<p>这个时候，我们需要做一件事：将留言的语句转为向量表示；或许会有疑问，这个怎么转为向量表示？这个时候我们就需要用到我们之前前面创建的词汇表了，我们为testEntry_1和testEntry_2创建长度和词汇表等长的list并初始化全为0，然后去和词汇表对比词汇，如果某个位置上的单词在留言testEntry_1或者testEntry_2中存在，那么就将testEntry_1或testEntry_2对应的list相应位置上的值赋值为1，这样，就成功的将testEntry_1和testEntry_2用向量进行了表示</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setOfWords2Vec</span><span class="params">(vocabList, inputSet)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    将字符串文本转为向量</span></span><br><span class="line"><span class="string">    :param vocabList:</span></span><br><span class="line"><span class="string">    :param inputSet:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    returnVec = [<span class="number">0</span>] * len(vocabList)</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> inputSet:</span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> vocabList:</span><br><span class="line">            returnVec[vocabList.index(word)] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"the word: %s is not in my Vocabluary!"</span> % word</span><br><span class="line">    <span class="keyword">return</span> returnVec</span><br></pre></td></tr></table></figure>
<p>接下来，我们该如何利用朴素贝叶斯来实现对留言的分类呢？首先我们需要先训练样本得出一些数据——样本留言中侮辱性留言的条件概率和非侮辱性的条件概率以及任取一条留言是侮辱性留言的概率。那么是怎么得出的呢？</p>
<ul>
<li>先分别计算在非侮辱性（侮辱性）留言下每个词汇出现的次数</li>
<li>再计算非侮辱性（侮辱性）留言中所有词汇的个数</li>
<li>计算非侮辱性（侮辱性）词汇出现的概率pa（pb）</li>
<li>计算样本中任取一则留言为侮辱性留言的概率pc</li>
<li>将未知的留言文本向量分别乘上pa（pb）后在加上1-pc（pc）</li>
<li>比较两个结果的值，取概率大的</li>
</ul>
<p>由于我们要求的目标概率是p（待分类留言|侮辱性留言）和p（待分类留言|非侮辱性留言），也就是p（c|x）；那么我们就反过来计算p（x|c），就是计算一则留言中侮辱性词汇出现的概率是多少，非侮辱性的词汇出现的概率是多少。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trainNBO</span><span class="params">(trainMatrix, trainCategory)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :param trainMatrix:    文档矩阵，二维矩阵，第一个维度表示文档的数目，第二个维度表示文档的内容向量</span></span><br><span class="line"><span class="string">    :param trainCategory:      文档类别标签组成的向量</span></span><br><span class="line"><span class="string">    :return:        返回每个单词属于侮辱性单词的概率</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    numTrainDocs = len(trainMatrix)</span><br><span class="line">    numWords = len(trainMatrix[<span class="number">0</span>])</span><br><span class="line">    pAbusive = sum(trainCategory) / float(numTrainDocs)</span><br><span class="line">    p0Num = ones(numWords)</span><br><span class="line">    p1Num = ones(numWords)</span><br><span class="line">    p0Denom = <span class="number">2.0</span></span><br><span class="line">    p1Denom = <span class="number">2.0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(numTrainDocs):</span><br><span class="line">        <span class="keyword">if</span> trainCategory[i] == <span class="number">1</span>:</span><br><span class="line">            p1Num += trainMatrix[i]</span><br><span class="line">            p1Denom += sum(trainMatrix[i])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p0Num += trainMatrix[i]</span><br><span class="line">            p0Denom += sum(trainMatrix[i])</span><br><span class="line">    <span class="comment"># 为了防止出现概率因为精度问题出现0的情况，采用对乘积取对数的操作</span></span><br><span class="line">    <span class="keyword">print</span> p1Num</span><br><span class="line">    p1Vect = log(p1Num / p1Denom)</span><br><span class="line">    p0Vect = log(p0Num / p0Denom)</span><br><span class="line">    <span class="keyword">return</span> p0Vect, p1Vect, pAbusive</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">classifyNB</span><span class="params">(vec2Classify, p0Vec, p1Vec, pClass1)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    朴素贝叶斯分类器</span></span><br><span class="line"><span class="string">    :param vec2Classify:       要分类的向量</span></span><br><span class="line"><span class="string">    :param p0Vec:      标准一</span></span><br><span class="line"><span class="string">    :param p1Vec:      标准二</span></span><br><span class="line"><span class="string">    :param pClass1:        概率（侮辱性文本占所有文本的概率）</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    p1 = sum(vec2Classify * p1Vec) + log(pClass1)</span><br><span class="line">    p0 = sum(vec2Classify * p0Vec) + log(<span class="number">1.0</span> - pClass1)</span><br><span class="line">    <span class="keyword">if</span> p1 &gt; p0:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">testingNB</span><span class="params">()</span>:</span></span><br><span class="line">    listOPosts, listClasses = loadDataSet()</span><br><span class="line">    myVocabList = createVocabList(listOPosts)</span><br><span class="line">    trainMat = []</span><br><span class="line">    <span class="comment"># trainMat[] 将所有文本转为向量形式</span></span><br><span class="line">    <span class="keyword">for</span> postinDoc <span class="keyword">in</span> listOPosts:</span><br><span class="line">        trainMat.append(setOfWords2Vec(myVocabList, postinDoc))</span><br><span class="line">    p0V, p1V, pAb = trainNBO(array(trainMat), array(listClasses))</span><br><span class="line">    testEntry = [<span class="string">'love'</span>, <span class="string">'my'</span>, <span class="string">'dalmation'</span>]</span><br><span class="line">    thisDoc = array(setOfWords2Vec(myVocabList, testEntry))</span><br><span class="line">    <span class="keyword">print</span> testEntry, <span class="string">'classified as: '</span>, classifyNB(thisDoc, p0V, p1V, pAb)</span><br><span class="line">    testEntry = [<span class="string">'stupid'</span>, <span class="string">'garbage'</span>]</span><br><span class="line">    thisDoc = array(setOfWords2Vec(myVocabList, testEntry))</span><br><span class="line">    <span class="keyword">print</span> testEntry, <span class="string">'classified as: '</span>, classifyNB(thisDoc, p0V, p1V, pAb)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">testingNB()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>结果</p>
</blockquote>
<p><img src="http://120.24.90.180/blog/image/machine_learning/machine-learning-3.1.png" alt="machine-learning-3.1"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/31/leetcode-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/31/leetcode-3/" itemprop="url">
                  ToeplitzMatrix 判断矩阵对角线上元素是否相同
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-31 12:02:35" itemprop="dateCreated datePublished" datetime="2018-01-31T12:02:35+08:00">2018-01-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-02-26 19:13:30" itemprop="dateModified" datetime="2018-02-26T19:13:30+08:00">2018-02-26</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>题目</p>
</blockquote>
<p>“””<br>A matrix is Toeplitz if every diagonal from top-left to bottom-right has the same element.</p>
<p>Now given an M x N matrix, return True if and only if the matrix is Toeplitz.</p>
<p>Example 1:</p>
<p>Input: matrix = [[1,2,3,4],[5,1,2,3],[9,5,1,2]]<br>Output: True<br>Explanation:<br>1234<br>5123<br>9512</p>
<p>In the above grid, the diagonals are “[9]”, “[5, 5]”, “[1, 1, 1]”, “[2, 2, 2]”, “[3, 3]”, “[4]”, and in each diagonal all elements are the same, so the answer is True.<br>Example 2:</p>
<p>Input: matrix = [[1,2],[2,2]]<br>Output: False<br>Explanation:<br>The diagonal “[1, 2]” has different elements.</p>
<p>Note:</p>
<p>matrix will be a 2D array of integers.<br>matrix will have a number of rows and columns in range [1, 20].<br>matrix[i][j] will be integers in range [0, 99].<br>“””</p>
<blockquote>
<p>思路</p>
</blockquote>
<p>这道题其实就是一个搜索问题，怎么去搜索？搜索的边界如何确定？这就是解决问题的关键。比如说题目的例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],</span><br><span class="line"> [<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line"> [<span class="number">9</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>]]</span><br></pre></td></tr></table></figure>
<p>实际上就是对角线去搜索元素是否相同就可以。一种做法是从第一行开始对角元素遍历，将遍历过的元素全部置为-1，表示已经访问过的元素，当第一行遍历完成后转向第二行开始遍历，同时注意遍历的边界——一个矩阵的行列；遍历过程如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">第一轮 (<span class="string">''</span>号代表第一轮访问)</span><br><span class="line">[[<span class="string">'1'</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],      [[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="number">3</span>,<span class="number">4</span>],      [[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="number">4</span>],       [[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>],</span><br><span class="line"> [<span class="number">5</span>,<span class="string">'1'</span>,<span class="number">2</span>,<span class="number">3</span>],  =&gt;   [<span class="number">5</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="number">3</span>],  =&gt;   [<span class="number">5</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>],        [<span class="number">5</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>],</span><br><span class="line"> [<span class="number">9</span>,<span class="number">5</span>,<span class="string">'1'</span>,<span class="number">2</span>]]       [<span class="number">9</span>,<span class="number">5</span>,<span class="string">'1'</span>,<span class="string">'2'</span>]]       [<span class="number">9</span>,<span class="number">5</span>,<span class="string">'1'</span>,<span class="string">'2'</span>]]          [<span class="number">9</span>,<span class="number">5</span>,<span class="string">'1'</span>,<span class="string">'2'</span>]]</span><br><span class="line"></span><br><span class="line"> 第二轮(‘’号代表第二轮访问)</span><br><span class="line">[[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>],      [[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>],           [[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>],  </span><br><span class="line"> [<span class="number">5</span>,<span class="string">'’1‘'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>],  =&gt;   [<span class="string">'5'</span>,<span class="string">'’1‘'</span>,<span class="string">'’2‘'</span>,<span class="string">'3'</span>],   =&gt;   [<span class="string">'5'</span>,<span class="string">'’1‘'</span>,<span class="string">'’2‘'</span>,<span class="string">'‘3’'</span>],</span><br><span class="line"> [<span class="number">9</span>,<span class="number">5</span>,<span class="string">'1'</span>,<span class="string">'2'</span>]]           [<span class="number">9</span>,<span class="string">'5'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>]]              [<span class="number">9</span>,<span class="string">'5'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>]]</span><br><span class="line"></span><br><span class="line"> 第三轮</span><br><span class="line"> [[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>],             [[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>],                [[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>],</span><br><span class="line">  [<span class="string">'5'</span>,<span class="string">'‘1’'</span>,<span class="string">'‘2’'</span>,<span class="string">'‘3’'</span>],   =&gt;   [<span class="string">'5'</span>,<span class="string">'‘1’'</span>,<span class="string">'‘2’'</span>,<span class="string">'‘3’'</span>],   =&gt;      [<span class="string">'5'</span>,<span class="string">'‘1’'</span>,<span class="string">'‘2’'</span>,<span class="string">'‘3’'</span>],</span><br><span class="line">  [<span class="string">'9'</span>,<span class="string">'‘5’'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>]]            [<span class="string">'9'</span>,<span class="string">'‘5’'</span>,<span class="string">'‘1’'</span>,<span class="string">'2'</span>]]             [<span class="string">'9'</span>,<span class="string">'‘5’'</span>,<span class="string">'‘1’'</span>,<span class="string">'‘2’'</span>]]</span><br></pre></td></tr></table></figure>
<p>这种做法是最普通的，但也是最耗时的，因为在第一行进行第一轮的对角元素遍历后，再从第二行开始对角元素遍历时，实际上会遍历在刚刚第一轮就已经遍历过的元素，做了许多无用功。因此，重新观察矩阵之后，可以知道，只需要从第一行和第一列进行对角元素遍历就可以解决了，这就是第二种方法，相比于第一种方法，避免做了无用的访问。</p>
<blockquote>
<p>解题代码</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isToeplitzMatrix</span><span class="params">(self, matrix)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        第一种解决方法</span></span><br><span class="line"><span class="string">        :type matrix: List[List[int]]</span></span><br><span class="line"><span class="string">        :rtype: bool</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        length = len(matrix[<span class="number">0</span>])        </span><br><span class="line">        width = len(matrix)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(width):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(length):</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span> <span class="keyword">and</span> j == length - <span class="number">1</span>) <span class="keyword">or</span> (i == width - <span class="number">1</span> <span class="keyword">and</span> j == <span class="number">0</span>):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> matrix[i][j] == <span class="number">-1</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                temp_i = i + <span class="number">1</span>                </span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> range(j + <span class="number">1</span>, length):</span><br><span class="line">                    <span class="keyword">if</span> temp_i &lt;= width - <span class="number">1</span>:</span><br><span class="line">                        <span class="keyword">if</span> matrix[i][j] == matrix[temp_i][k]:</span><br><span class="line">                            matrix[temp_i][k] = <span class="number">-1</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">                    temp_i += <span class="number">1</span></span><br><span class="line">                matrix[i][j] = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(self, matrix)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        第二种解决方法</span></span><br><span class="line"><span class="string">        :type matrix: List[List[int]]</span></span><br><span class="line"><span class="string">        :rtype: bool</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        length = len(matrix[<span class="number">0</span>])</span><br><span class="line">        width = len(matrix)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">            <span class="keyword">if</span> i == length: <span class="keyword">break</span></span><br><span class="line">            j = <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> range(i + <span class="number">1</span>, length):</span><br><span class="line">                <span class="keyword">if</span> j == width: <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> matrix[<span class="number">0</span>][i] == matrix[j][k]: matrix[j][k] = <span class="number">-1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">            matrix[<span class="number">0</span>][i] = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, width):</span><br><span class="line">            <span class="keyword">if</span> i == width: <span class="keyword">break</span></span><br><span class="line">            j = i + <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">1</span>, length):</span><br><span class="line">                <span class="keyword">if</span> j == width: <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> matrix[i][<span class="number">0</span>] == matrix[j][k]: matrix[j][k] = <span class="number">-1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">            matrix[i][<span class="number">0</span>] = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    s = Solution()</span><br><span class="line">    <span class="keyword">print</span> s.isToeplitzMatrix([[<span class="number">11</span>,<span class="number">74</span>,<span class="number">0</span>,<span class="number">93</span>],[<span class="number">40</span>,<span class="number">11</span>,<span class="number">74</span>,<span class="number">7</span>]])</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">49</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a> v6.4.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script>



  



  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
